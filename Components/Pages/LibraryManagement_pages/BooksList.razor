@page "/bookslist"
@inject IBookRepository BookRepository

@if (IsLoading)
{
    <div class="position-absolute w-75  h-75 d-flex flex-column align-items-center bg-white justify-content-center">
        <img src="/images/loading-book.gif" alt="loading" />
        <p>Ładowanie...</p>
    </div>
}

else
{
    <div class="card shadow border-0 m-4">
        <div class="card-header bg-black bg-gradient ml-0 py-3">
            <div class="row">
                <div class="col-12 text-center">
                    <h2 class="text-white py-2">Lista książek</h2>
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <div class="row pb-3">
                <div class="col-12 text-end">
                    <a href="/addbook" class="btn btn-lg btn-secondary" style="width:250px;">
                        <i class="bi bi-plus-square-fill"></i> Dodaj nową książkę
                    </a>
                </div>
            </div>
            @if (Books.Any())
            {
                <table class="table table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Akcje</th>
                            <th>Tytuł</th>
                            <th>Autor</th>
                            <th>Wydawca</th>
                            <th>Typ</th>
                            <th>Kategoria</th>
                            <th>ISBN</th>
                            <th>Rok</th>
                            <th>Strony</th>
                            <th>Widoczna</th>
                            <th>Gatunki</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var book in Books)
                        {
                            <tr>
                                <td>
                                    <a href="/editbook/@book.Id" class="btn btn-primary">
                                        <i class="bi bi-pencil-square"></i> Edytuj
                                    </a>
                                    <button class="btn btn-danger" >
                                        <i class="bi bi-trash3"></i> Usuń
                                    </button>
                                </td>
                                <td>@book.Title</td>
                                <td>@book.BookAuthor</td>
                                <td>@book.BookPublisher</td>
                                <td>@book.BookType</td>
                                <td>@book.BookCategory</td>
                                <td>@book.Isbn</td>
                                <td>@book.Year</td>
                                <td>@book.PageCount</td>
                                <td>@(book.IsVisible ? "Tak" : "Nie")</td>
                                <td>
                                    @string.Join(", ", book.BookGenres)
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            }
        </div>
    </div>
}

@code {
    private bool IsLoading { get; set; } = true;
    private IEnumerable<BookGetDto> Books { get; set; } = new List<BookGetDto>();

    protected override async Task OnInitializedAsync()
    {
        await LoadBooks();
        IsLoading = false;

    }

    private async Task LoadBooks()
    {
        Books = await BookRepository.GetBooksAsync();
    }
}